{"version":3,"file":"MinecraftAuth.js","sourceRoot":"/","sources":["MinecraftAuth.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,sDAA8B;AAC9B,qDAAuC;AAEvC,MAAa,aAAa;IAItB,YACqB,eAAgF;QAAhF,oBAAe,GAAf,eAAe,CAAiE;IAErG,CAAC;IAED,KAAK,CAAC,kBAAkB,CAAC,WAAmB;QACxC,OAAO,MAAM,MAAM,CAAC,SAAS,CAAC;YAC1B,EAAE,EAAE,MAAM;YACV,IAAI,EAAE,oBAAoB;SAC7B,EAAE,KAAK,IAAI,EAAE;YACV,aAAa,CAAC,MAAM,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAA;YAChD,MAAM,oBAAoB,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC;gBACtE,MAAM,EAAE,KAAK;gBACb,GAAG,EAAE,gDAAgD;gBACrD,OAAO,EAAE;oBACL,aAAa,EAAE,UAAW,WAAY,EAAE;iBAC3C;aACJ,CAAC,CAAC;YACH,MAAM,gBAAgB,GAAG,oBAAoB,CAAC,IAAI,CAAC;YACnD,+BAA+B;YAC/B,gCAAgC;YAChC,OAAO,gBAAgB,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,gBAAgB,CAAC,OAAO,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;QAC5F,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,KAAK,CAAC,UAAU,CAAC,WAAmB;QACvC,OAAO,MAAM,MAAM,CAAC,SAAS,CAAC;YAC1B,EAAE,EAAE,MAAM;YACV,IAAI,EAAE,YAAY;SACrB,EAAE,KAAK,IAAI,EAAE;YACV,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,wBAAwB,CAAC;gBACjE,MAAM,EAAE,KAAK;gBACb,GAAG,EAAE,oBAAoB;gBACzB,OAAO,EAAE;oBACL,eAAe,EAAE,UAAW,WAAY,EAAE;iBAC7C;aACJ,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC,IAAI,CAAC;QACzB,CAAC,CAAC,CAAC;IACP,CAAC;;AA3CL,sCA6CC;AA3CU,oBAAM,GAAmB,iBAAO,CAAC,YAAY,EAAE,CAAC","sourcesContent":["import { RequestHandlers } from \"./types/RequestHandler\";\r\nimport { BasicMojangProfile } from \"@mineskin/types\";\r\nimport winston from \"winston\";\r\nimport * as Sentry from \"@sentry/node\";\r\n\r\nexport class MinecraftAuth {\r\n\r\n    static logger: winston.Logger = winston.createLogger();\r\n\r\n    constructor(\r\n        private readonly requestHandlers: RequestHandlers<'minecraftServices'|'minecraftServicesProfile'>\r\n    ) {\r\n    }\r\n\r\n    async checkGameOwnership(accessToken: string): Promise<boolean> {\r\n        return await Sentry.startSpan({\r\n            op: 'auth',\r\n            name: 'checkGameOwnership'\r\n        }, async () => {\r\n            MinecraftAuth.logger.debug(\"checkGameOwnership\")\r\n            const entitlementsResponse = await this.requestHandlers.minecraftServices({\r\n                method: \"GET\",\r\n                url: \"https://api.minecraftservices.com/entitlements\",\r\n                headers: {\r\n                    Authorization: `Bearer ${ accessToken }`\r\n                }\r\n            });\r\n            const entitlementsBody = entitlementsResponse.data;\r\n            // console.log(\"entitlements\");\r\n            // console.log(entitlementsBody)\r\n            return entitlementsBody.hasOwnProperty(\"items\") && entitlementsBody[\"items\"].length > 0;\r\n        });\r\n    }\r\n\r\n    public async getProfile(accessToken: string): Promise<BasicMojangProfile> {\r\n        return await Sentry.startSpan({\r\n            op: 'auth',\r\n            name: 'getProfile'\r\n        }, async () => {\r\n            const response = await this.requestHandlers.minecraftServicesProfile({\r\n                method: \"GET\",\r\n                url: \"/minecraft/profile\",\r\n                headers: {\r\n                    \"Authorization\": `Bearer ${ accessToken }`\r\n                }\r\n            });\r\n            return response.data;\r\n        });\r\n    }\r\n\r\n}\r\n"]}